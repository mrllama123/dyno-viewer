app-id: org.flatpak.dyna-cli
runtime: org.freedesktop.Platform
runtime-version: '22.08'
sdk: org.freedesktop.Sdk
command: flatpak-runner.sh
finish-args:
  - --filesystem=home
  - --filesystem=xdg-cache
  - --share=network
modules:
  - name: cpython
    sources:
      - type: archive
        url: https://www.python.org/ftp/python/3.10.7/Python-3.10.7.tar.xz
        sha256: 6eed8415b7516fb2f260906db5d48dd4c06acc0cb24a7d6cc15296a604dcdc48
  - name: build-deps
    buildsystem: simple
    build-options:
      build-args:
        - "--share=network" 
    build-commands:
      - pip3 install -r requirements.txt
    sources:
      - type: file
        path: requirements.txt
  - name: build
    buildsystem: simple
    build-commands:
      - cp -r dyna_cli /app/dyna_cli
    sources:
      - type: dir
        path: dyna_cli/
        dest: dyna_cli/
  - name: runner
    buildsystem: simple
    build-commands:
      - install -D flatpak-runner.sh /app/bin/flatpak-runner.sh
    sources:
      - type: file
        path: scripts/flatpak-runner.sh

  - name: icons
    buildsystem: simple
    build-commands:
      - mkdir -p /app/share/icons/hicolor/scalable/apps
      - cp org.flatpak.dyna-cli.svg /app/share/icons/hicolor/scalable/apps/org.flatpak.dyna-cli.svg
    sources:
      - type: file
        path: icons/org.flatpak.dyna-cli.svg

  - name: metainfo
    buildsystem: simple
    build-commands:
      - mkdir -p /app/share/metainfo
      - cp org.flatpak.dyna-cli.metainfo.xml /app/share/metainfo/org.flatpak.dyna-cli.metainfo.xml
    sources:
      - type: file
        path: org.flatpak.dyna-cli.metainfo.xml